<section class="admin-card">
  <header>
    <h1>Opening Hours Admin</h1>
    <p>Configure the business opening schedule and publish once complete.</p>
  </header>

  <form [formGroup]="form" (ngSubmit)="save()">
    <div class="meta-grid">
      <label>
        Timezone
        <input type="text" formControlName="timezone" placeholder="Europe/London" />
      </label>

      <label>
        Effective from
        <input type="date" formControlName="effectiveFrom" />
      </label>
    </div>

    <div formArrayName="days" class="day-list">
      <article
        class="day-card"
        *ngFor="let dayForm of dayForms.controls; let dayIndex = index; trackBy: trackByDay"
        [formGroupName]="dayIndex"
      >
        <div class="day-header">
          <h2>{{ weekdays[dayIndex].label }}</h2>
          <label class="toggle">
            <input type="checkbox" formControlName="enabled" />
            Open this day
          </label>
        </div>

        <div formArrayName="slots" class="slots" *ngIf="dayForm.controls.enabled.value; else closedTemplate">
          <div class="slot-row" *ngFor="let slot of slotForms(dayIndex).controls; let slotIndex = index" [formGroupName]="slotIndex">
            <label>
              Opens
              <select formControlName="opensAt">
                <option *ngFor="let timeOption of timeOptions" [value]="timeOption">
                  {{ timeOption }}
                </option>
              </select>
            </label>

            <label>
              Closes
              <select formControlName="closesAt">
                <option *ngFor="let timeOption of timeOptions" [value]="timeOption">
                  {{ timeOption }}
                </option>
              </select>
            </label>

            <button type="button" class="danger" (click)="removeSlot(dayIndex, slotIndex)">Remove</button>
          </div>

          <button type="button" class="secondary" (click)="addSlot(dayIndex)">Add time slot</button>
        </div>

        <ng-template #closedTemplate>
          <p class="closed-pill">Closed</p>
        </ng-template>
      </article>
    </div>

    <section class="holiday-section" formArrayName="recurringHolidays">
      <h2>Recurring holidays</h2>
      <div class="holiday-toolbar">
        <label>
          Add holiday
          <select #holidayTemplate [value]="defaultHolidayTemplateId">
            <option *ngFor="let template of holidayTemplates" [value]="template.id">
              {{ holidayTemplateLabel(template) }}
            </option>
          </select>
        </label>
        <button type="button" class="secondary" (click)="addHolidayFromTemplate(holidayTemplate.value)">
          Add recurring holiday
        </button>
      </div>

      <article class="holiday-card" *ngFor="let holiday of holidayForms.controls; let holidayIndex = index" [formGroupName]="holidayIndex">
        <div class="holiday-header">
          <h3>{{ holiday.controls.name.value }}</h3>

          <label class="toggle">
            <input type="checkbox" formControlName="closed" />
            Closed
          </label>
        </div>

        <p class="holiday-rule">{{ holidaySummary(holiday) }}</p>

        <div formArrayName="slots" class="slots" *ngIf="!holiday.controls.closed.value; else holidayClosedTemplate">
          <div class="slot-row" *ngFor="let slot of holidaySlotForms(holidayIndex).controls; let slotIndex = index" [formGroupName]="slotIndex">
            <label>
              Opens
              <select formControlName="opensAt">
                <option *ngFor="let timeOption of timeOptions" [value]="timeOption">
                  {{ timeOption }}
                </option>
              </select>
            </label>

            <label>
              Closes
              <select formControlName="closesAt">
                <option *ngFor="let timeOption of timeOptions" [value]="timeOption">
                  {{ timeOption }}
                </option>
              </select>
            </label>

            <button type="button" class="danger" (click)="removeHolidaySlot(holidayIndex, slotIndex)">Remove</button>
          </div>

          <button type="button" class="secondary" (click)="addHolidaySlot(holidayIndex)">Add time slot</button>
        </div>

        <ng-template #holidayClosedTemplate>
          <p class="closed-pill">Closed</p>
        </ng-template>

        <div class="holiday-actions">
          <button type="button" class="danger" (click)="removeHoliday(holidayIndex)">Remove</button>
        </div>
      </article>
    </section>

    <div class="actions">
      <button type="submit">Save opening hours</button>
    </div>
  </form>

  <section class="preview">
    <h3>Payload preview</h3>
    <pre>{{ serializedSchedule() }}</pre>
  </section>
</section>
